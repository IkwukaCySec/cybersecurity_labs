# custom_rules.conf - ModSecurity rules for Day 3 Bincom Academy Assignment
# Purpose: Block common SQL Injection and XSS payloads in DVWA
# Author: Ikwuka Okoye
# Date: February 2026

<IfModule mod_security2.c>

    # Enable the engine (already set in modsecurity.conf, but reinforced here)
    SecRuleEngine On

    # Rule 1001: Block basic SQL Injection patterns
    # Detects keywords like UNION, SELECT, OR, AND, sleep(), benchmark(), comments
    SecRule ARGS "@rx (?i)(\bunion\b|\bselect\b|\bor\b|\band\b|\bsleep\s*\(|benchmark\s*\(|--|#)" \
        "id:1001,\
        phase:2,\
        log,\
        deny,\
        status:403,\
        msg:'SQL Injection Attempt Detected',\
        tag:'SQLi',\
        severity:'CRITICAL'"

    # Rule 1002: Block basic XSS patterns
    # Detects script tags, common event handlers, alert(), document.cookie, img onerror, etc.
    SecRule ARGS "@rx (?i)(<script|</script|onerror|onload|onmouseover|alert\s*\(|document\.cookie|<img[^>]+onerror)" \
        "id:1002,\
        phase:2,\
        log,\
        deny,\
        status:403,\
        msg:'XSS Attempt Detected',\
        tag:'XSS',\
        severity:'HIGH'"

    # Optional: Block common file inclusion attempts (LFI/RFI) - useful bonus for DVWA
    SecRule ARGS "@rx (?i)(\.\./|\.\.%2f|%2e%2e/|etc/passwd|proc/self/environ)" \
        "id:1003,\
        phase:2,\
        log,\
        deny,\
        status:403,\
        msg:'File Inclusion Attempt Detected',\
        tag:'LFI/RFI',\
        severity:'HIGH'"

</IfModule>
