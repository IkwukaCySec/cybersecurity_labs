#!/usr/bin/env python3
# Volatility 3 Wrapper for Malhare Memory Analysis
# Automates common commands

import subprocess
import argparse

def run_volatility(cmd, dump_file, profile="Win10x64"):
    base_cmd = ["vol.py", "-f", dump_file, "--profile", profile]
    full_cmd = base_cmd + cmd.split()
    try:
        result = subprocess.run(full_cmd, capture_output=True, text=True)
        print(result.stdout)
        if result.stderr:
            print(f"Error: {result.stderr}")
    except:
        print("[-] Volatility execution failed")

parser = argparse.ArgumentParser(description="Volatility Analyzer for Malhare")
parser.add_argument("dump", help="Memory dump file")
parser.add_argument("--pid", help="PID of mshta.exe")
args = parser.parse_args()

print("[*] Running pslist...")
run_volatility("windows.pslist", args.dump)

if args.pid:
    print(f"\n[*] Dumping PID {args.pid} memory...")
    run_volatility(f"windows.memdump --pid {args.pid} --dump-dir dumps", args.dump)
    
    print("\n[*] Malfind scan...")
    run_volatility(f"windows.malfind --pid {args.pid}", args.dump)

print("\n[+] Analysis complete - Check dumps/ folder")
